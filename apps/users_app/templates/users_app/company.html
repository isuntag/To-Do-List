<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>Company Lists</title>
    </head>
    <body>
        <h1>Company Lists</h1>
        <a href="{%url 'users:index'%}">Your Lists</a> | {% if user.is_admin %}<a href="{%url 'users:admin'%}">Admin Page</a> | {% endif %}<a href="{%url 'users:logout'%}">Logout</a>
        <h3>Lists</h3>
        <table class="table table-striped">
            <thead>
                <tr>
                    <th>List Title</th>
                    <th># of Tasks</th>
                    <th>Users</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
            {% if all_lists %}
                {% for list in all_lists %}
                    <tr>
                        <td><a href="{%url 'lists:add' id=list.id%}">{{ list.title }}</a></td>
                        <td>{{ list.num_tasks }}</td>
                        <td>{{ list.users.count }}</td>
                        <td>{% if list.creator == user %}
                            {% if list.users.count < all_users.all.count%}
                                <form action="{%url 'lists:adduser' id=list.id%}" method="POST">
                                    {% csrf_token %}
                                    <select name="user">
                                        {% for oneuser in all_users %}
                                            {% if oneuser != user %}
                                                <option value="{{oneuser.id}}">{{oneuser.first_name}} {{oneuser.last_name}}</option>
                                            {% endif %}
                                        {% endfor %}
                                    </select>
                                    <input type="submit" value="add user"/>
                                </form>
                            {%endif%}
                            {% if list.users.all.count > 1 %}
                            <form action="{%url 'lists:removeuser' id=list.id%}" method="POST">
                                {% csrf_token %}
                                <select name="user">
                                    <option value="" selected disabled hidden>Choose here</option>
                                {% for one_user in all_users %}
                                    {% if one_user in list.users.all and one_user != user %}
                                        <option value="{{one_user.id}}">{{one_user.first_name}} {{one_user.last_name}}</option>
                                    {% endif %}
                                {% endfor %}
                                </select>
                                <input type="submit" value="Remove User"/>
                            </form>
                            {% endif %}
                            <a href="{%url 'lists:delete' id=list.id%}">Delete</a>
                        {% endif %}</td>
                    </tr>
                {% endfor %}
            {% endif %}
            </tbody>
        </table>
    </body>
</html>
